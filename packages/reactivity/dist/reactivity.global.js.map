{"version":3,"file":"reactivity.global.js","sources":["../../shared/src/index.ts","../src/baseHandlers.ts","../src/reactive.ts"],"sourcesContent":["// 公共方法\nexport function isObject(target) {\n    return typeof target === 'object' && target != null;\n}\n","import { isObject } from '@vue/shared';\nimport { reactive, readonly } from './reactive';\n\nfunction createGetter(isReadonly = false, shallow = false) {\n    return function get(target, key, receiver) {\n        // proxy + reflect\n        const res = Reflect.get(target, key, receiver); // target[key] 代理\n        // 判断\n        if (!isReadonly) {\n            return; //依赖收集 effect相当于watcher\n        }\n        if (shallow) {\n            return res; //浅 仅对第一层代理\n        }\n        // key 是一个对象 递归  vue3  懒代理state.list\n        if (isObject(res)) {\n            return isReadonly ? readonly(res) : reactive(res); //递归\n        }\n        return res;\n    };\n}\nconst get = createGetter();\nconst shallowget = createGetter(false, true);\nconst readonlyGet = createGetter(true);\nconst shallowReadonlyGet = createGetter(true, true);\n\nfunction createSetter(shallow = false) {\n    return function (target, key, value, receiver) {\n        const res = Reflect.set(target, key, value, receiver); //获取最新的值\n        // 触发更新\n\n        return res;\n    };\n}\nconst set = createSetter();\nconst shallowSet = createSetter(true);\nexport const reactiveHandlers = {\n    get,\n    set,\n};\nexport const shallowReactiveHandlers = {\n    get: shallowget,\n    shallowSet,\n};\nexport const readonlyHandlers = {\n    get: readonlyGet,\n    set: (target, key, value) => {\n        console.log(`set on key is failed`);\n    },\n};\nexport const shallowReadonlyHandlers = {\n    get: shallowReadonlyGet,\n    set: shallowSet,\n};\n// 方法  (1)只读 (2)深的\n// 柯里化  同一个方法据不同参数来处理逻辑\n//\n\n// 单词\n// receiver接收器 reflect反射\n","import { isObject } from '@vue/shared';\nimport { reactiveHandlers, readonlyHandlers, shallowReactiveHandlers, shallowReadonlyHandlers } from './baseHandlers';\n\nexport function reactive(target) {\n    return createReactObj(target, false, reactiveHandlers);\n}\nexport function shallowReactive(target) {\n    return createReactObj(target, false, shallowReactiveHandlers);\n}\nexport function readonly(target) {\n    return createReactObj(target, true, readonlyHandlers);\n}\nexport function shallowReadonly(target) {\n    return createReactObj(target, true, shallowReadonlyHandlers);\n}\n// TODO 实现代理\nconst reactiveMap = new WeakMap(); //key 必须是对象 自动的垃圾回收\nconst readonlyMap = new WeakMap();\nfunction createReactObj(target, isReadOnly, baseHandlers) {\n    if (!isObject(target)) {\n        return target;\n    }\n    // 优化\n    const proxymap = isReadOnly ? readonlyMap : reactiveMap;\n    const proxyEs = proxymap.get(target); //有\n    if (proxyEs) {\n        return proxyEs;\n    }\n    const proxy = new Proxy(target, baseHandlers); //baseHandlers 处理 各自的细节 {get,  set} \n    proxymap.set(target, proxy); //存放\n    return proxy;\n}\n// 4个方法  (1)是不是只读 (2)是不是深  {list:{}}\n// 注意  核心 proxy 源码中  柯里化： 根据不同的参数  proxy(target,{})\n// 被代理的数据 优化 不再处理\n"],"names":[],"mappings":"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"}