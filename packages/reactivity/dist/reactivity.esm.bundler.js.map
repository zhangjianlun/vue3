{"version":3,"file":"reactivity.esm.bundler.js","sources":["../../shared/src/index.ts","../src/baseHandlers.ts","../src/reactive.ts"],"sourcesContent":["// 公共方法\nexport function isObject(target) {\n    return typeof target === 'object' && target != null;\n}\n","import { isObject } from '@vue/shared';\nimport { reactive, readonly } from './reactive';\n\nfunction createGetter(isReadonly = false, shallow = false) {\n    return function get(target, key, receiver) {\n        // proxy + reflect\n        const res = Reflect.get(target, key, receiver); // target[key] 代理\n        // 判断\n        if (!isReadonly) {\n            return; //依赖收集 effect相当于watcher\n        }\n        if (shallow) {\n            return res; //浅 仅对第一层代理\n        }\n        // key 是一个对象 递归  vue3  懒代理state.list\n        if (isObject(res)) {\n            return isReadonly ? readonly(res) : reactive(res); //递归\n        }\n        return res;\n    };\n}\nconst get = createGetter();\nconst shallowget = createGetter(false, true);\nconst readonlyGet = createGetter(true);\nconst shallowReadonlyGet = createGetter(true, true);\n\nfunction createSetter(shallow = false) {\n    return function (target, key, value, receiver) {\n        const res = Reflect.set(target, key, value, receiver); //获取最新的值\n        // 触发更新\n\n        return res;\n    };\n}\nconst set = createSetter();\nconst shallowSet = createSetter(true);\nexport const reactiveHandlers = {\n    get,\n    set,\n};\nexport const shallowReactiveHandlers = {\n    get: shallowget,\n    shallowSet,\n};\nexport const readonlyHandlers = {\n    get: readonlyGet,\n    set: (target, key, value) => {\n        console.log(`set on key is failed`);\n    },\n};\nexport const shallowReadonlyHandlers = {\n    get: shallowReadonlyGet,\n    set: shallowSet,\n};\n// 方法  (1)只读 (2)深的\n// 柯里化  同一个方法据不同参数来处理逻辑\n//\n\n// 单词\n// receiver接收器 reflect反射\n","import { isObject } from '@vue/shared';\nimport { reactiveHandlers, readonlyHandlers, shallowReactiveHandlers, shallowReadonlyHandlers } from './baseHandlers';\n\nexport function reactive(target) {\n    return createReactObj(target, false, reactiveHandlers);\n}\nexport function shallowReactive(target) {\n    return createReactObj(target, false, shallowReactiveHandlers);\n}\nexport function readonly(target) {\n    return createReactObj(target, true, readonlyHandlers);\n}\nexport function shallowReadonly(target) {\n    return createReactObj(target, true, shallowReadonlyHandlers);\n}\n// TODO 实现代理\nconst reactiveMap = new WeakMap(); //key 必须是对象 自动的垃圾回收\nconst readonlyMap = new WeakMap();\nfunction createReactObj(target, isReadOnly, baseHandlers) {\n    if (!isObject(target)) {\n        return target;\n    }\n    // 优化\n    const proxymap = isReadOnly ? readonlyMap : reactiveMap;\n    const proxyEs = proxymap.get(target); //有\n    if (proxyEs) {\n        return proxyEs;\n    }\n    const proxy = new Proxy(target, baseHandlers); //baseHandlers 处理 各自的细节 {get,  set} \n    proxymap.set(target, proxy); //存放\n    return proxy;\n}\n// 4个方法  (1)是不是只读 (2)是不是深  {list:{}}\n// 注意  核心 proxy 源码中  柯里化： 根据不同的参数  proxy(target,{})\n// 被代理的数据 优化 不再处理\n"],"names":[],"mappings":"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"}